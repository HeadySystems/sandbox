# ═══════════════════════════════════════════════════════════════════════
# HEADY SYSTEMS — Secrets Manifest
# ═══════════════════════════════════════════════════════════════════════
# Declares every secret/token in the ecosystem, its source, expiry
# policy, and what depends on it. The SecretsManager uses this at boot
# to register and monitor all credentials.

version: "1.0.0"

secrets:
  # ─── Cloudflare (auto-refreshable) ────────────────────────────────
  - id: cloudflare_oauth
    name: Cloudflare OAuth Token
    source: file
    envVar: null
    filePath: wrangler_config  # resolved at runtime
    expiryPolicy: 1h  # Cloudflare OAuth tokens last ~1 hour
    refreshable: true
    refreshMethod: oauth_refresh
    dependents: [cloudflare-worker, dns-management, domain-routing]
    tags: [cloudflare, oauth, auto-refresh, infrastructure]

  - id: cloudflare_refresh_token
    name: Cloudflare Refresh Token
    source: file
    expiryPolicy: single_use  # replaced on each refresh
    refreshable: false
    tags: [cloudflare, oauth]

  # ─── Render (API key — no auto-expiry) ────────────────────────────
  - id: render_api_key
    name: Render API Key
    source: env
    envVar: RENDER_API_KEY
    expiryPolicy: manual  # user must rotate
    refreshable: false
    dependents: [render-deploy, service-management]
    tags: [render, api-key, infrastructure]

  # ─── Heady Internal ───────────────────────────────────────────────
  - id: heady_api_key
    name: Heady API Key
    source: env
    envVar: HEADY_API_KEY
    expiryPolicy: manual
    refreshable: false
    dependents: [api-gateway, mcp-server]
    tags: [heady, auth, internal]

  - id: admin_token
    name: Admin Token
    source: env
    envVar: ADMIN_TOKEN
    expiryPolicy: manual
    refreshable: false
    dependents: [admin-panel, system-production]
    tags: [heady, auth, admin]

  # ─── Database ─────────────────────────────────────────────────────
  - id: database_url
    name: PostgreSQL Connection String
    source: env
    envVar: DATABASE_URL
    expiryPolicy: never
    refreshable: false
    dependents: [database, persistence]
    tags: [database, postgres, infrastructure]

  # ─── Hugging Face ─────────────────────────────────────────────────
  - id: hf_token
    name: Hugging Face API Token
    source: env
    envVar: HF_TOKEN
    expiryPolicy: manual  # HF tokens don't auto-expire but can be revoked
    refreshable: false
    dependents: [pythia-node, ai-inference]
    tags: [huggingface, ai, api-key]

  # ─── Notion ───────────────────────────────────────────────────────
  - id: notion_token
    name: Notion Integration Token
    source: env
    envVar: NOTION_TOKEN
    expiryPolicy: manual
    refreshable: false
    dependents: [notion-sync, checkpoint-protocol]
    tags: [notion, integration]

  # ─── GitHub ───────────────────────────────────────────────────────
  - id: github_token
    name: GitHub Personal Access Token
    source: env
    envVar: GITHUB_TOKEN
    expiryPolicy: manual  # PATs have configurable expiry
    refreshable: false
    dependents: [heady-sync, ci-cd, copilot]
    tags: [github, auth, vcs]

  # ─── Stripe ───────────────────────────────────────────────────────
  - id: stripe_secret_key
    name: Stripe Secret Key
    source: env
    envVar: STRIPE_SECRET_KEY
    expiryPolicy: never  # Stripe keys don't expire but can be rolled
    refreshable: false
    dependents: [billing, pricing-tiers]
    tags: [stripe, payments, billing]

  - id: stripe_webhook_secret
    name: Stripe Webhook Secret
    source: env
    envVar: STRIPE_WEBHOOK_SECRET
    expiryPolicy: never
    refreshable: false
    dependents: [billing-webhooks]
    tags: [stripe, payments, webhook]

# ─── Policies ───────────────────────────────────────────────────────
policies:
  warnBeforeExpiryMinutes: 15
  checkIntervalSeconds: 60
  auditRetention: 500
  alertChannels:
    - console
    - api  # GET /api/secrets/alerts
  rotationReminders:
    render_api_key: 90d
    heady_api_key: 90d
    hf_token: 180d
    github_token: 90d
    notion_token: never
