<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><title>Heady AI Sidebar</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{height:100vh;background:#0d0d1a;color:#e0e0e0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;display:flex;flex-direction:column}
    header{padding:16px;background:linear-gradient(135deg,#1a1a2e,#16213e);border-bottom:1px solid rgba(124,58,237,0.3);display:flex;align-items:center;gap:10px}
    header h1{font-size:16px;font-weight:600}
    #status{margin-left:auto;font-size:11px;padding:3px 8px;border-radius:10px}
    .online{background:rgba(34,197,94,0.2);color:#22c55e}.offline{background:rgba(239,68,68,0.2);color:#ef4444}
    #chat{flex:1;overflow-y:auto;padding:12px}
    .msg{margin:8px 0;padding:12px 16px;border-radius:16px;font-size:14px;line-height:1.6;word-wrap:break-word}
    .msg.user{background:rgba(124,58,237,0.15);margin-left:30px;text-align:right}
    .msg.assistant{background:rgba(255,255,255,0.04);margin-right:30px}
    .input-area{display:flex;gap:8px;padding:12px;border-top:1px solid rgba(255,255,255,0.05);background:#0d0d1a}
    .input-area textarea{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(124,58,237,0.3);background:rgba(255,255,255,0.05);color:#e0e0e0;font-size:14px;resize:none;outline:none;min-height:44px}
    .input-area button{padding:12px 18px;border-radius:12px;border:none;background:#7c3aed;color:white;cursor:pointer;font-size:14px}
  </style>
</head>
<body>
  <header><span style="font-size:24px">&#x2B22;</span><h1>Heady AI</h1><span id="status" class="offline">Checking...</span></header>
  <div id="chat"><div class="msg assistant">Hi! I'm Heady. Ask me anything about this page or any topic.</div></div>
  <div class="input-area"><textarea id="input" placeholder="Ask Heady..." rows="1"></textarea><button id="send">Send</button></div>
  <script>
    const HEADY_API='http://manager.dev.local.heady.internal:3300';const chat=document.getElementById('chat');const input=document.getElementById('input');const status=document.getElementById('status');
    async function checkHealth(){try{const r=await fetch(`${HEADY_API}/api/health`);status.textContent=r.ok?'Connected':'Offline';status.className=r.ok?'online':'offline'}catch{status.textContent='Offline';status.className='offline'}}
    checkHealth();setInterval(checkHealth,30000);
    document.getElementById('send').addEventListener('click',send);
    input.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send()}});
    async function send(){const text=input.value.trim();if(!text)return;addMsg('user',text);input.value='';
      try{const r=await fetch(`${HEADY_API}/api/buddy/chat`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:text,context:'edge_sidebar',source:'browser-extension-edge',history:[]})});const d=await r.json();addMsg('assistant',d.reply||d.message||'No response')}catch(e){addMsg('assistant',`Error: ${e.message}`)}}
    function addMsg(role,text){const d=document.createElement('div');d.className=`msg ${role}`;d.textContent=text;chat.appendChild(d);chat.scrollTop=chat.scrollHeight}
    chrome.runtime.onMessage.addListener(msg=>{if(msg.type==='SIDE_PANEL_QUERY'){input.value=msg.query;send()}});
  </script>
</body>
</html>
